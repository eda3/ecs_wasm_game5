# マルチプレイソリティア開発計画書 🚀

これは、Rust + WASM + 自作ECSで作るマルチプレイソリティアゲームの開発計画チェックリストだよ！✅

## フェーズ 1: プロジェクトセットアップ & ECS基盤構築 🏗️

- [x] Rust WASM プロジェクトの基本セットアップ (`Cargo.toml`, `wasm-pack`, ビルド設定) // 基本はOK
- [x] `wasm-bindgen` の設定と JS 連携の準備 // 基本はOK
- [x] ログ出力 (`console.log`) とパニックハンドリングの設定 (`console_error_panic_hook`)
- [x] ECSコア実装: `Entity` 型の定義
- [x] ECSコア実装: `Component` の概念定義 (トレイト？ マーカー？) // 基本はOK
- [x] ECSコア実装: `World` 構造体の実装 (エンティティとコンポーネントの管理)
- [x] ECSコア実装: `World` エンティティ作成・削除 // コンポーネント単位削除は実装済
- [x] ECSコア実装: `World` コンポーネント追加・削除・取得
- [x] ECSコア実装: `World` 特定コンポーネントを持つエンティティのクエリ
- [x] ECSコア実装: `System` の概念定義 (トレイト？ 関数？) // 基本ファイルは作成済
- [x] 基本コンポーネント定義: `Position` (x, y座標)
- [x] 基本コンポーネント定義: `Card` (スート, ランク, 表裏)
- [x] 基本コンポーネント定義: `Player` (ID, 名前など)
- [x] 基本コンポーネント定義: `StackInfo` (どの場のカードか、場の中での位置)
- [x] 基本コンポーネント定義: `GameState` (ゲーム全体の状態管理用？)

## フェーズ 2: 基本ゲームロジック & 画面表示 (クライアント単体) 🃏🖼️

- [x] ゲーム初期化: カードデッキ生成ロジック // create_standard_deck in card.rs
- [x] ゲーム初期化: 初期カード配置 (ディール) システムの実装 // deal_system.rs & lib.rs に deal_initial_cards() を実装！✨
- [x] レンダリング準備: `GameApp` (WASM側メイン構造体) の実装 (`src/lib.rs`)
- [x] レンダリング準備: `GameApp` から World の状態を取得するメソッド実装 // get_world_state_json() を実装！🦴→✅
- [x] レンダリング準備: JS側でWASMをロードし、`GameApp` インスタンスを作成 // www/bootstrap.js で実装！🚀
- [x] レンダリング準備: 基本的なHTML/CSS構造の作成 (`index.html`, `style.css`) // www/ に作成！🎨
- [x] レンダリング準備: JSから定期的にWASMのゲーム状態を取得し、コンソール等に表示 (デバッグ用) // bootstrap.js のボタンと定期更新で部分的に実装！⚙️
- [x] レンダリング準備: Canvas や DOM を使った基本的なカード描画 (JS側) // bootstrap.js と style.css で実装！🃏

## フェーズ 3: ネットワーク実装 🌐🤝

- [x] 通信プロトコル定義: `ClientMessage` (クライアント → サーバー) の定義 (JoinGame, MakeMove など)
- [x] 通信プロトコル定義: `ServerMessage` (サーバー → クライアント) の定義 (GameJoined, GameStateUpdate, MoveRejected など)
- [x] 通信プロトコル定義: メッセージ共通で使うデータ構造 (PlayerId, CardData, GameStateData など) の定義
- [x] 通信プロトコル定義: `serde` を使ったシリアライズ/デシリアライズ設定
- [x] クライアント側ネットワーク処理: WebSocket接続マネージャー (`NetworkManager`) の実装
- [x] クライアント側ネットワーク処理: 接続・切断処理 (URL: `ws://162.43.8.148:8101`) // 接続は実装済
- [x] クライアント側ネットワーク処理: メッセージ送信・受信キュー
- [x] クライアント側ネットワーク処理: 接続状態管理 (`ConnectionStatus`)
- [ ] クライアント側ネットワーク処理: 再接続ロジック (任意)
- [x] クライアント側ネットワーク処理: `GameApp` から `NetworkManager` を利用
- [x] クライアント側ネットワーク処理: `connect()` メソッド
- [x] クライアント側ネットワーク処理: `send_message()` ヘルパーメソッド
- [x] クライアント側ネットワーク処理: `send_join_game()`, `send_make_move()` などWASM公開メソッド
- [x] クライアント側ネットワーク処理: `process_received_messages()` で受信キューを処理
- [x] クライアント側ネットワーク処理: `apply_game_state()` で受信データ (`GameStateData`) を `World` に反映 // 基本実装済
- [ ] サーバー側: WebSocketサーバーの起動 (`162.43.8.148:8101`)
- [ ] サーバー側: クライアント接続管理
- [ ] サーバー側: メッセージ受信・処理 (JoinGame, MakeMove)
- [ ] サーバー側: ゲーム状態管理 (簡易でOK)
- [ ] サーバー側: クライアントへのメッセージ送信 (GameStateUpdate など)

## フェーズ 4: ソリティアのルールとインタラクション実装 🎮👆

- [ ] ルール実装: カード移動ルールのバリデーション (タブローからタブローへ)
- [ ] ルール実装: カード移動ルールのバリデーション (タブローからファンデーションへ)
- [ ] ルール実装: カード移動ルールのバリデーション (ストックからウェストへ)
- [ ] ルール実装: カード移動ルールのバリデーション (ウェストからタブロー/ファンデーションへ)
- [ ] ルール実装: 自動カード移動 (ダブルクリック時など、任意)
- [ ] ルール実装: ゲームクリア判定
- [ ] UIインタラクション: カードのドラッグ＆ドロップ実装
- [ ] UIインタラクション: カードのクリック/ダブルクリック実装
- [ ] UIインタラクション: UI操作をWASMの `send_make_move` 呼び出しに変換
- [ ] 状態更新と表示: `apply_game_state` で受け取った情報に基づき、カード表示を更新 (JS側)
- [ ] 状態更新と表示: サーバーから `MoveRejected` を受け取った場合のフィードバック表示

## フェーズ 5: マルチプレイヤー同期と仕上げ ✨💅

- [ ] プレイヤー表示: 他のプレイヤーの情報 (名前など) を画面に表示
- [ ] プレイヤー表示: プレイヤーの参加/退出をリアルタイムに反映 (`PlayerJoined`, `PlayerLeft` メッセージ処理)
- [ ] 同期の安定化: 複数プレイヤー操作時の状態同期の整合性確認・改善
- [ ] 同期の安定化: 遅延や競合状態への対策 (必要であれば)
- [ ] UI/UX改善: アニメーション追加
- [ ] UI/UX改善: 見た目の改善 (CSS)
- [ ] UI/UX改善: 操作性の向上
- [ ] エラーハンドリング: ネットワークエラー時の表示
- [ ] エラーハンドリング: サーバーエラー時の表示

## フェーズ 6: テストとデプロイ 🧪🚀

- [ ] テスト: ECSコア機能の単体テスト
- [ ] テスト: ゲームロジック (ルール) の単体テスト
- [ ] テスト: ネットワーク通信の結合テスト (簡易サーバーと連携)
- [ ] ビルドと最適化: リリースビルド (`wasm-pack build --release`)
- [ ] ビルドと最適化: WASMバイナリサイズの最適化 (`wasm-opt` など)
- [ ] デプロイ準備: 静的ファイル (HTML, CSS, JS, WASM) を配信するHTTPサーバーの設定 (`162.43.8.148:8001` 想定)
- [ ] デプロイ準備: WebSocketサーバーのデプロイ
- [ ] デプロイ！ 🎉 